\documentclass{beamer}
\usepackage[applemac]{inputenc}
\usepackage[spanish,activeacute]{babel}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{latexsym}
\usepackage{listings}

%\newcommand{\speech}[1]{{\small #1}}
\newcommand{\hpage}{$\lambda Page$}
\newcommand{\haskell}{\textsl{Haskell}}
\newcommand{\speech}[1]{}
\newcommand{\G}{\mathcal{G}}
\usetheme{DC}


\title{\hpage}
\author{\textsl{Fernando~Benavides}}
	
\institute{Departamento de Computaci—n, FCEyN,Universidad de Buenos Aires.}

\date{\today}

%\beamerdefaultoverlayspecification{<+->}

\begin{document}

\begin{frame}
	\titlepage
\end{frame}

\section{Presentaci—n}
\subsection{El Orador}
\begin{frame}
	\frametitle{El Orador}
     \emph{>quiŽn soy?}\\
     \begin{itemize}
       \item Fernando Benavides
	 \end{itemize}
	\pause
     \emph{>c—mo lleguŽ hasta aqu’?}\\
     \begin{itemize}
       \item Alumno de Computaci—n desde 2001
       \item Programador desde hace m‡s de 10 a–os
       \item Programador \textsl{Funcional} desde hace 2 a–os
	\end{itemize}
\end{frame}

\subsection{El Proyecto}
\begin{frame}
     \frametitle{\hpage}
     \emph{Un bloc de notas para usuarios \haskell}\\~\\
	\pause
     \emph{Una herramienta para...}
	\begin{itemize}
		\item debuggear
		\item entender c—digo
		\item realizar \textsl{micro-testing}
	\end{itemize}
\end{frame}

\subsection{Motivaci—n}
\begin{frame}
	\frametitle{Contexto}
	Presenciamos actualmente la aparici—n de varias aplicaciones desarrolladas dentro del \textsl{paradigma funcional}:
		\begin{itemize}
			\item CouchDB
			\item ejabberd
			\item Chat de Facebook
		\end{itemize}
		\pause
	Desarrolladas en lenguajes como:
		\begin{itemize}
			\item Erlang
			\item Haskell
		\end{itemize}
\end{frame}
\begin{frame}
\frametitle{Necesidades}
	Para desarrollar en \haskell\, existen herramientas como:
		\begin{itemize}
			\item GHCi
			\item Hugs
			\item Hat
		\end{itemize}
	\pause
	Pero no existen herramientas como
	\begin{itemize}
		\item \textbf{Java} Scrapbook Pages
		\item Workspace de \textbf{Smalltalk}
	\end{itemize}
\end{frame}
\begin{frame}
	\frametitle{\hpage}
	\hpage\ es una herramienta similar al Workspace de Smalltalk, en tanto:
	\begin{itemize}
		\item permite al desarrollador trabajar con texto libre
		\item detecta expresiones y definiciones v‡lidas
		\item permite inspeccionarlas y evaluarlas
	\end{itemize}
	\pause
	Adem‡s, \hpage, brinda otras facilidades particulares para \haskell:
	\begin{itemize}
		\item Integraci—n con \textsl{Cabal} y \textsl{Hayoo!}
		\item Aprovecha \textsl{lazy evaluation} y \textsl{tipado est‡tico}
		\item Presenta resultados din‡micamente
	\end{itemize}
\end{frame}

\lstset{language=haskell, frame=single, tabsize=2}
\section{Caracter’sticas Principales}
\subsection{Expresiones Simples}
\begin{frame}[fragile]
\frametitle{Interpretaci—n de Expresiones}
	\hpage\ permite interpretar expresiones como:
	\begin{lstlisting}
		[1,2,3]
	\end{lstlisting}
	\pause
	\begin{lstlisting}
		xs = [1,2,3] :: [Float]
		ys = map (+) xs
	\end{lstlisting}
	\pause
	\begin{lstlisting}
		[1,2..]
	\end{lstlisting}
	\pause
	\begin{lstlisting}
		let loop = loop in 1:loop
	\end{lstlisting}
\end{frame}
\begin{frame}
\frametitle{Presentaci—n de Resultados}
	\begin{itemize}
		\item Para expresiones inv‡lidas, \hpage\ presenta el error informado por \textsl{GHC}
		\item Para expresiones sin resultado ``visible'', \hpage\ permite conocer su tipo
		\item Para expresiones infinitas, \hpage\ presenta su valor incrementalmente hasta que el usuario cancela la evaluaci—n
		\item Para expresiones que requieren c‡lculos infinitos, \hpage\ permite al usuario cancelar la evaluaci—n
	\end{itemize}
\end{frame}

\subsection{Expresiones Complejas}
\begin{frame}[fragile]
\frametitle{Acciones con Efectos Colaterales}
	Para realizar acciones que puedan generar efectos colaterales, en \haskell\ se utiliza la m—nada \texttt{IO}.  Por ejemplo:
	\begin{lstlisting}
		readFile ``README'' :: IO String
	\end{lstlisting}
	\pause
	\texttt{IO String} no es un tipo ``visible'', por lo que el valor de la expresi—n no se podr’a mostrar.
	\pause \\
	Pero \hpage\ toma el modelo de \textsl{GHCi} y ejecuta la acci—n, presentando su resultado
\end{frame}
\begin{frame}[fragile]
\frametitle{Listas}
	\hpage\ interpreta de modo particular las listas (expresiones de tipo \texttt{Show a => [a]})\\
	Tomemos como ejemplo la siguiente expresi—n:
	\begin{lstlisting}
		let loop = loop in [1, div 0 0, 2,
		                    undefined, 3, loop, 4]
	\end{lstlisting}
\end{frame}
\begin{frame}[fragile]
	\frametitle{Listas}
	\begin{lstlisting}
		let loop = loop in [1, div 0 0, 2,
		                    undefined, 3, loop, 4]
	\end{lstlisting} ~\\
	Si \hpage\ presentase su evaluaci—n tal como lo hace con las dem‡s expresiones, el resultado ser’a\\~\\
	\framebox[1\textwidth]{\texttt{[1,}} \\~\\
	e informar’a al usuario la excepci—n encontrada (o sea, \texttt{DivideByZero})
\end{frame}
\begin{frame}[fragile]
	\frametitle{Listas}
	\begin{lstlisting}
		let loop = loop in [1, div 0 0, 2,
		                    undefined, 3, loop, 4]
	\end{lstlisting} ~\\
	\hpage\, en cambio, podr’a evaluar cada elemento por separado y detectar excepciones.  En tal caso, el resultado ser’a\\~\\
	\framebox[1\textwidth]{\texttt{[1, $_{\bot}$, 2, $_{\bot}$, 3, }} \\~\\
	y continuar’a intentando calcular el siguiente elemento hasta que el usuario decidiese cancelar
\end{frame}
\begin{frame}[fragile]
	\frametitle{Listas}
	\begin{lstlisting}
		let loop = loop in [1, div 0 0, 2,
		                    undefined, 3, loop, 4]
	\end{lstlisting} ~\\
	\hpage, sin embargo, detecta c‡lculos posiblemente infinitos y presenta como resultado:\\~\\
	\framebox[1\textwidth]{\texttt{[1, $_{\bot}$, 2, $_{\bot}$, 3,  $_{\bot}$, 4]}} \\~\\
	permitiendo luego al usuario conocer el motivo de cada $_{\bot}$ a travŽs de un menœ contextual
\end{frame}

\subsection{Otras Caracter’sticas}
\begin{frame}
\frametitle{Paralelismo}
	Muchas cosas suceden al mismo tiempo en \hpage\:
	\begin{itemize}
		\item Manejo de P‡ginas (crear, abrir, modificar, guardar, cerrar, etc.)
		\item Interpretaci—n de Expresiones
		\item Evaluaci—n de Acciones de Entrada/Salida
	\end{itemize}
	\pause
	Para lograrlo, creamos \textsl{eprocess}:
	\begin{itemize}
		\item Basada conceptualmente en \textsl{Erlang}
		\item Constru’da utilizando \textsl{Threads}, \textsl{Channels} y \textsl{MVars}
	\end{itemize}
\end{frame}
\begin{frame}
\frametitle{Manejo de M—dulos}
	Utilizando \hpage, el usuario puede
	\begin{itemize}
		\item Importar m—dulos
		\item Cargar m—dulos
		\item Recargar m—dulos
		\item Ver los m—dulos de un paquete \textsl{Cabal}
		\item Ver la documentaci—n de un m—dulo utilizando \textsl{Hayoo!}
	\end{itemize}
	Todo esto \textsl{sin perder las expresiones que ya tiene definidas}
\end{frame}

\section{\hpage\ por Dentro}
\subsection{Arquitectura}
\begin{frame}
\frametitle{Arquitectura}
\begin{columns}[c]
	\column{.5\textwidth}Principales Requerimientos:
	\begin{itemize}
		\item Conexi—n con GHC
		\item Paralelismo
		\item Errores Controlados
		\item Presentaci—n de Resultados
	\end{itemize}
	\column{.5\textwidth}
		\includegraphics[height=.75\textheight]{pictures/architecture}
\end{columns}
\end{frame}
\begin{frame}
\frametitle{Componentes}
	\begin{description}
		\item[\texttt{~~~~UI Manager}] Administrador de la GUI
		\item[\texttt{~~HPage Server}] Interfaz entre la GUI y \textsl{GHC}
		\item[\texttt{~~~~~IO Server}] Para ejecutar acciones de entrada/salida
		\item[\texttt{~~~Hint Server}] Conecta \textsl{HPage} y \textsl{GHC}
		\item[\texttt{~~Value Filler}] Encargado de procesar y mostrar expresiones
		\item[\texttt{Element Filler}] Encargado de evaluar elementos
		\item[\texttt{Runaway Killer}] Detector de c‡lculos infinitos
	\end{description}
\end{frame}

\subsection{Dise–o}
\begin{frame}
\frametitle{Principales Decisiones de Dise–o}
	\begin{itemize}
		\item Creaci—n de \textsl{eprocess}
		\item Creaci—n de \textbf{servers}
		\item Presentaci—n de Interpretaciones
			\begin{itemize}
				\item Entrada/Salida
				\item Listas
				\item Tipos
				\item Expresiones ``visibles''
				\item Expresiones ``no visibles''
			\end{itemize}
		\item Integraci—n con \textsl{Cabal} y \textsl{Hayoo!}		
	\end{itemize}
\end{frame}
\lstset{basicstyle=\small}
\subsection{Implementaci—n}
\begin{frame}[fragile]
\frametitle{\textsl{eprocess}}
	\begin{lstlisting}
newtype ReceiverT r m a
	\end{lstlisting}
	\pause
	\begin{lstlisting}
type Process r = ReceiverT r IO
	\end{lstlisting}
	\pause
	\begin{lstlisting}
spawn :: MonadIO m => Process r k -> m (Handle r)
kill :: MonadIO m => Handle a -> m ()
self :: Monad m => ReceiverT r m (Handle r)
sendTo :: MonadIO m => Handle a -> a -> m ()
recv :: MonadIO m => ReceiverT r m r
	\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\frametitle{Servers (\texttt{IOServer})}
\begin{lstlisting}
newtype ServerHandle = SH {handle :: Handle (IO ())}

start :: IO ServerHandle
start = spawn ioRunner >>= return . SH
    where ioRunner = forever $ recv >>= liftIO

runIn :: ServerHandle -> IO a ->
         IO (Either SomeException a)
runIn server action = runHere $ do
    me <- self
    sendTo (handle server) $ try action >>=
                                    sendTo me
                                    recv
stop :: ServerHandle -> IO ()
stop = kill . handle
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\frametitle{\texttt{HPage.Control}}
\begin{lstlisting}
newtype Expression = Exp {exprText :: String}       
    deriving (Eq, Show)

data Page = Page { -- Display --
                   expressions :: [Expression],
                   currentExpr :: Int,
                   undoActions :: [HPage ()],
                   redoActions :: [HPage ()],
                   -- File System --
                   original :: [Expression],
                   filePath    :: Maybe FilePath
                  }
\end{lstlisting}
\end{frame}
\begin{frame}[fragile]
\frametitle{\texttt{HPage.Control}}
\begin{lstlisting}
data Context = Context { -- Package --
    activePackage :: Maybe PackageIdentifier,
    pkgModules :: [Hint.ModuleName],
    -- Pages --
    pages :: [Page],
    currentPage :: Int,
    -- GHC State --
    loadedModules :: Set String,
    importedModules :: Set String,
    extraSrcDirs :: [FilePath],
    ghcOptions :: String,
    server :: HS.ServerHandle,
    ioServer :: HPIO.ServerHandle,
    -- Actions --
    recoveryLog :: Hint.InterpreterT IO () }
\end{lstlisting}
\end{frame}


\section{Resultados}
\subsection{Logros}
\begin{frame}
\frametitle{Objetivos Alcanzados}
	\hpage\ permite al usuario
	\begin{itemize}
		\item Configurar de entorno segœn paquetes \textsl{Cabal}
		\item Editar p‡ginas mientras se evalœa una expresi—n
		\item Visualizar expresiones con errores o c‡lculos infinitos sin bloquearse mostrando el resultado m‡s completo posible
		\item Importar, cargar y recargar m—dulos sin perder las expresiones con las que est‡ trabajando
		\item Intercalar definiciones, expresiones y texto libre
	\end{itemize}
\end{frame}
\begin{frame}
\frametitle{Logros Adicionales}
	M‡s all‡ de los objetivos propuestos para esta tesis, \hpage\ permite
	\begin{itemize}
		\item Consultar la API de \haskell utilizando \textsl{Hayoo!}
		\item Trabajar en \textsl{OSX}, \textsl{Windows} y \textsl{Linux}
		\item Administrar varias p‡ginas con expresiones, pudiendo cargarlas, guardarlas, etc.
		\item Determinar el contexto de evaluaci—n din‡micamente
		\item Navegar m—dulos importados o cargados
	\end{itemize}
\end{frame}

\subsection{Trabajo a Futuro}
\begin{frame}
\frametitle{Tareas a Realizar}
	\begin{itemize}
		\item Mejoras visuales
		\pause
		\item Presentaci—n de resultados:
		\begin{itemize}
			\item Nuevas visualizaciones
			\item Distintos tipos a tratar de modo particular
			\item Composici—n
		\end{itemize}
		\pause
		\item Otras herramientas
		\begin{itemize}
			\item Soporte para TDD
			\item Refactoring
			\item An‡lisis de Terminaci—n
			\item Debugging
		\end{itemize}
		\pause
		\item Otros lenguajes
		\begin{itemize}
			\item Erlang
		\end{itemize}
	\end{itemize}
\end{frame}

\subsection{Agradecimientos / Preguntas}
\begin{frame}
\frametitle{!`Gracias a todos!}
	\emph{?`En quŽ los puedo ayudar?}
\end{frame}
\end{document}